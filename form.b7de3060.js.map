{"mappings":"ACAA,SAAS,IAGP,IAAI,EAAmB,OAEjB,EAAa,SAAS,cAAc,CAAC,aACrC,EAAgB,SAAS,cAAc,CAAC,gBACxC,EAAc,SAAS,cAAc,CAAC,cAS5C,SAAS,EAAS,CAAe,EAC/B,EAAQ,EANR,EAAW,SAAS,CAAC,MAAM,CAAC,SAAU,AAAU,SAAV,GACtC,EAAc,SAAS,CAAC,MAAM,CAAC,SAAU,AAAU,YAAV,GACzC,EAAY,SAAS,CAAC,MAAM,CAAC,SAAU,AAAU,UAAV,EAMzC,CAEA,IAAM,EAAwB,AAAC,CAAA,KAC7B,IAAM,EAAO,SAAS,cAAc,CAAC,QACrC,GAAI,CAAE,CAAA,aAAgB,eAAA,EACpB,MAAM,AAAI,MAAM,+CAElB,OAAO,CACT,CAAA,IAEM,EAAgC,AAAC,CAAA,KACrC,IAAM,EAAO,SAAS,cAAc,CAAC,gBACrC,GAAI,CAAE,CAAA,aAAgB,gBAAA,EACpB,MAAM,AAAI,MAAM,yDAElB,OAAO,CACT,CAAA,IAEM,EAAiC,AAAC,CAAA,KACtC,IAAM,EAAO,SAAS,cAAc,CAAC,kBACrC,GAAI,CAAE,CAAA,aAAgB,gBAAA,EACpB,MAAM,AAAI,MAAM,yDAElB,OAAO,CACT,CAAA,IAEM,EAAkC,AAAC,CAAA,KACvC,IAAM,EAAO,SAAS,cAAc,CAAC,UACrC,GAAI,CAAE,CAAA,aAAgB,iBAAA,EACpB,MAAM,AAAI,MAAM,mDAElB,OAAO,CACT,CAAA,IAMA,SAAS,IACP,EAAa,QAAQ,CAAG,CAJjB,EAAK,aAAa,EAK3B,CAEA,SAAS,IACP,IAAM,EAAyB,EAAY,KAAK,CAEhD,GAAI,AAAU,OAAV,GAAkB,AAAiB,IAAjB,EAAM,MAAM,EAIlC,GAAI,EAAM,MAAM,CAAG,EACjB,MAAM,AAAI,MAAM,CAAC,kCAAkC,EAAE,EAAM,MAAM,CAAA,CAAE,CAIrE,CAAA,EAAa,GAAG,CADA,IAAI,eAAe,CAAC,CAAK,CAAC,EAAE,EAE9C,CAEA,eAAe,EAAO,CAAY,EAChC,EAAM,cAAc,GACpB,QAAQ,GAAG,CAAC,UACZ,IAAM,EAAW,IAAI,SAAS,GAExB,EAAO,EAAS,GAAG,CAAC,gBACpB,EAAW,EAAK,IAAI,CAK1B,GAJA,EAAS,MAAM,CAAC,WAAY,GAC5B,EAAS,MAAM,CAAC,gBAChB,QAAQ,GAAG,CAAC,GAEP,EAIL,GAAI,CAGF,IAAM,EAAM,MAAM,MAAM,iDAA4D,CAClF,OAAQ,OACR,KAAM,CACR,GAEA,GAAI,CAAC,EAAI,EAAE,CAAE,YACX,EAAS,SAKX,IAAM,EAAa,AADH,CAAA,MAAM,EAAI,IAAI,EAA9B,EAC2B,UAAU,CAWrC,GAAI,CAAC,AARa,CAAA,MAAM,MAAM,EAAY,CACxC,OAAQ,MACR,QAAS,CACP,eAAgB,EAAK,IAAI,AAC3B,EACA,KAAM,CACR,EAAA,EAEe,EAAE,CAAE,YACjB,EAAS,SAGX,EAAS,UACX,CAAE,MAAO,EAAG,CACV,EAAS,SACT,QAAQ,KAAK,CAAC,EAChB,CACF,CAEA,EAAY,gBAAgB,CAAC,SAAU,GACvC,IAEA,EAAa,gBAAgB,CAAC,QAAS,GAEvC,EAAK,gBAAgB,CAAC,QAAS,GAC/B,EAAK,gBAAgB,CAAC,SAAU,EAClC,CAGI,AAAwB,aAAxB,SAAS,UAAU,CACrB,IAEA,SAAS,gBAAgB,CAAC,mBAAoB","sources":["<anon>","src/form.ts"],"sourcesContent":["var $60dac1bf23cd5e04$exports = {};\nfunction $60dac1bf23cd5e04$var$main() {\n    let state = 'form';\n    const elFormView = document.getElementById('view-form');\n    const elSuccessView = document.getElementById('view-success');\n    const elErrorView = document.getElementById('view-error');\n    function render() {\n        // Show only the active view\n        elFormView.classList.toggle('hidden', state !== 'form');\n        elSuccessView.classList.toggle('hidden', state !== 'success');\n        elErrorView.classList.toggle('hidden', state !== 'error');\n    }\n    function setState(next) {\n        state = next;\n        render();\n    }\n    const form = (()=>{\n        const elem = document.getElementById(\"form\");\n        if (!(elem instanceof HTMLFormElement)) throw new Error(\"Expected a <form> tag with id 'form' in DOM\");\n        return elem;\n    })();\n    const imageUpload = (()=>{\n        const elem = document.getElementById(\"image_upload\");\n        if (!(elem instanceof HTMLInputElement)) throw new Error(\"Expected an <input> tag with id 'image_upload' in DOM\");\n        return elem;\n    })();\n    const imagePreview = (()=>{\n        const elem = document.getElementById(\"upload_preview\");\n        if (!(elem instanceof HTMLImageElement)) throw new Error(\"Expected an <img> tag with id 'upload_preview' in DOM\");\n        return elem;\n    })();\n    const submitButton = (()=>{\n        const elem = document.getElementById(\"submit\");\n        if (!(elem instanceof HTMLButtonElement)) throw new Error(\"Expected a <button> tag with id 'submit' in DOM\");\n        return elem;\n    })();\n    function isFormComplete() {\n        return form.checkValidity();\n    }\n    function updateSubmitState() {\n        submitButton.disabled = !isFormComplete();\n    }\n    function previewUpload() {\n        const files = imageUpload.files;\n        if (files === null || files.length === 0) return;\n        if (files.length > 1) throw new Error(`Expected one uploaded file, found ${files.length}`);\n        const dataUrl = URL.createObjectURL(files[0]);\n        imagePreview.src = dataUrl;\n    }\n    async function submit(event) {\n        event.preventDefault();\n        console.log(\"submit\");\n        const formData = new FormData(form);\n        const file = formData.get(\"image_upload\");\n        const filename = file.name;\n        formData.append(\"filename\", filename);\n        formData.delete(\"image_upload\");\n        console.log(formData);\n        if (!file) return;\n        try {\n            // @ts-ignore\n            const res = await fetch(\"https://api.biljettstrejk.se/api/register_fine\", {\n                method: \"POST\",\n                body: formData\n            });\n            if (!res.ok) {\n                setState(\"error\");\n                return;\n            }\n            const resData = await res.json();\n            const upload_url = resData.upload_url;\n            // Upload image\n            const uploadRes = await fetch(upload_url, {\n                method: \"PUT\",\n                headers: {\n                    \"Content-Type\": file.type\n                },\n                body: file\n            });\n            if (!uploadRes.ok) {\n                setState(\"error\");\n                return;\n            }\n            setState(\"success\");\n        } catch (e) {\n            setState(\"error\");\n            console.error(e);\n        }\n    }\n    imageUpload.addEventListener(\"change\", previewUpload);\n    previewUpload();\n    submitButton.addEventListener(\"click\", submit);\n    form.addEventListener('input', updateSubmitState);\n    form.addEventListener('change', updateSubmitState);\n}\n// Don't run main until the DOM is loaded.\nif (document.readyState === \"complete\") $60dac1bf23cd5e04$var$main();\nelse document.addEventListener(\"DOMContentLoaded\", $60dac1bf23cd5e04$var$main);\n\n\n//# sourceMappingURL=form.b7de3060.js.map\n","function main() {\n  type ViewState = 'form' | 'success' | 'error';\n\n  let state: ViewState = 'form';\n\n  const elFormView = document.getElementById('view-form') as HTMLElement;\n  const elSuccessView = document.getElementById('view-success') as HTMLElement;\n  const elErrorView = document.getElementById('view-error') as HTMLElement;\n\n  function render() {\n    // Show only the active view\n    elFormView.classList.toggle('hidden', state !== 'form');\n    elSuccessView.classList.toggle('hidden', state !== 'success');\n    elErrorView.classList.toggle('hidden', state !== 'error');\n  }\n\n  function setState(next: ViewState) {\n    state = next;\n    render();\n  }\n\n  const form: HTMLFormElement = (() => {\n    const elem = document.getElementById(\"form\")\n    if (!(elem instanceof HTMLFormElement)) {\n      throw new Error(\"Expected a <form> tag with id 'form' in DOM\")\n    }\n    return elem\n  })()\n\n  const imageUpload: HTMLInputElement = (() => {\n    const elem = document.getElementById(\"image_upload\")\n    if (!(elem instanceof HTMLInputElement)) {\n      throw new Error(\"Expected an <input> tag with id 'image_upload' in DOM\")\n    }\n    return elem\n  })()\n\n  const imagePreview: HTMLImageElement = (() => {\n    const elem = document.getElementById(\"upload_preview\")\n    if (!(elem instanceof HTMLImageElement)) {\n      throw new Error(\"Expected an <img> tag with id 'upload_preview' in DOM\")\n    }\n    return elem\n  })()\n\n  const submitButton: HTMLButtonElement = (() => {\n    const elem = document.getElementById(\"submit\")\n    if (!(elem instanceof HTMLButtonElement)) {\n      throw new Error(\"Expected a <button> tag with id 'submit' in DOM\")\n    }\n    return elem\n  })()\n\n  function isFormComplete() {\n    return form.checkValidity();\n  }\n\n  function updateSubmitState() {\n    submitButton.disabled = !isFormComplete();\n  }\n\n  function previewUpload() {\n    const files: FileList | null = imageUpload.files\n\n    if (files === null || files.length === 0) {\n      return\n    }\n\n    if (files.length > 1) {\n      throw new Error(`Expected one uploaded file, found ${files.length}`)\n    }\n\n    const dataUrl = URL.createObjectURL(files[0])\n    imagePreview.src = dataUrl\n  }\n\n  async function submit(event: Event) {\n    event.preventDefault();\n    console.log(\"submit\");\n    const formData = new FormData(form)\n\n    const file = formData.get(\"image_upload\") as File;\n    const filename = file.name;\n    formData.append(\"filename\", filename);\n    formData.delete(\"image_upload\");\n    console.log(formData);\n\n    if (!file) {\n      return;\n    }\n\n    try {\n\n      // @ts-ignore\n      const res = await fetch(process.env.FEE_STRIKE_API_ENDPOINT + \"/api/register_fine\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!res.ok) {\n        setState(\"error\");\n        return;\n      }\n      \n      const resData = await res.json();\n      const upload_url = resData.upload_url as string;\n\n      // Upload image\n      const uploadRes = await fetch(upload_url, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": file.type\n        },\n        body: file,\n      });\n\n      if (!uploadRes.ok) {\n        setState(\"error\");\n        return;\n      }\n      setState(\"success\");\n    } catch (e) {\n      setState(\"error\");\n      console.error(e);\n    }\n  }\n\n  imageUpload.addEventListener(\"change\", previewUpload)\n  previewUpload()\n\n  submitButton.addEventListener(\"click\", submit);\n\n  form.addEventListener('input', updateSubmitState);\n  form.addEventListener('change', updateSubmitState);\n}\n\n// Don't run main until the DOM is loaded.\nif (document.readyState === \"complete\") {\n  main()\n} else {\n  document.addEventListener(\"DOMContentLoaded\", main)\n}\n"],"names":["$60dac1bf23cd5e04$var$main","state","elFormView","document","getElementById","elSuccessView","elErrorView","setState","next","classList","toggle","form","elem","HTMLFormElement","Error","imageUpload","HTMLInputElement","imagePreview","HTMLImageElement","submitButton","HTMLButtonElement","updateSubmitState","disabled","checkValidity","previewUpload","files","length","src","URL","createObjectURL","submit","event","preventDefault","console","log","formData","FormData","file","get","filename","name","append","delete","res","fetch","method","body","ok","upload_url","resData","json","uploadRes","headers","type","e","error","addEventListener","readyState"],"version":3,"file":"form.b7de3060.js.map"}